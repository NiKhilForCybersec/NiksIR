<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DNS Security | SOC Analyst Guide</title>
  <meta name="description" content="DNS security for SOC analysts: DNS-based attacks, log analysis, threat detection, and investigation techniques.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Exo+2:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <button class="menu-toggle" aria-label="Toggle navigation">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M3 12h18M3 6h18M3 18h18"/>
    </svg>
  </button>

  <div class="page-wrapper">
        <aside class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo" style="text-decoration: none;">
          <span>SOC Analyst Guide</span>
        </a>
        <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">v2.0 | 92 Pages</p>
      </div>
      
      <div class="sidebar-nav">
        <div class="search-box">
          <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="text" class="search-input" placeholder="Search guide...">
        </div>

        <div class="nav-section">
          <div class="nav-section-title">1. SOC Foundations</div>
          <a href="getting-started.html" class="nav-link"><span class="nav-link-icon">ğŸš€</span> Getting Started</a>
          <a href="soc-overview.html" class="nav-link"><span class="nav-link-icon">ğŸ“‹</span> SOC Overview</a>
          <a href="soc-roles.html" class="nav-link"><span class="nav-link-icon">ğŸ‘¥</span> SOC Roles & Tiers</a>
          <a href="analyst-skills.html" class="nav-link"><span class="nav-link-icon">ğŸ¯</span> Analyst Skills</a>
          <a href="analyst-toolkit.html" class="nav-link"><span class="nav-link-icon">ğŸ§°</span> Analyst Toolkit</a>
          <a href="soc-metrics.html" class="nav-link"><span class="nav-link-icon">ğŸ“Š</span> SOC Metrics</a>
          <a href="shift-handoff.html" class="nav-link"><span class="nav-link-icon">ğŸ”„</span> Shift Handoff</a>
          <a href="alert-triage.html" class="nav-link"><span class="nav-link-icon">âš¡</span> Alert Triage</a>
          <a href="investigation-methodology.html" class="nav-link"><span class="nav-link-icon">ğŸ”</span> Investigation Methodology</a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">2. Ticketing & ITSM</div>
          <a href="ticket-management.html" class="nav-link"><span class="nav-link-icon">ğŸ«</span> Ticket Management</a>
          <a href="escalation-management.html" class="nav-link"><span class="nav-link-icon">ğŸ“ˆ</span> Escalation</a>
          <a href="communication-practices.html" class="nav-link"><span class="nav-link-icon">ğŸ’¬</span> Communication</a>
          <a href="status-reporting.html" class="nav-link"><span class="nav-link-icon">ğŸ“Š</span> Status Reporting</a>
          <a href="handoff-procedures.html" class="nav-link"><span class="nav-link-icon">ğŸ”„</span> Handoff Procedures</a>
          <a href="sla-management.html" class="nav-link"><span class="nav-link-icon">â±ï¸</span> SLA Management</a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">3. SIEM & Log Analysis</div>
          <a href="siem-fundamentals.html" class="nav-link"><span class="nav-link-icon">ğŸ“¡</span> SIEM Fundamentals</a>
          <a href="sentinel-overview.html" class="nav-link"><span class="nav-link-icon">ğŸ›¡ï¸</span> Microsoft Sentinel</a>
          <a href="sentinel-queries.html" class="nav-link"><span class="nav-link-icon">ğŸ’»</span> Sentinel Queries</a>
          <a href="kql-advanced.html" class="nav-link"><span class="nav-link-icon">ğŸš€</span> KQL Advanced</a>
          <a href="alert-creation.html" class="nav-link"><span class="nav-link-icon">ğŸ””</span> Alert Creation</a>
          <a href="siem-tuning.html" class="nav-link"><span class="nav-link-icon">ğŸšï¸</span> SIEM Tuning</a>
          <a href="workbook-creation.html" class="nav-link"><span class="nav-link-icon">ğŸ“ˆ</span> Workbook Creation</a>
          <a href="log-sources.html" class="nav-link"><span class="nav-link-icon">ğŸ“‹</span> Log Sources</a>
          <a href="log-correlation.html" class="nav-link"><span class="nav-link-icon">ğŸ”—</span> Log Correlation</a>
          <a href="threat-hunting.html" class="nav-link"><span class="nav-link-icon">ğŸ¯</span> Threat Hunting</a>
          <a href="hunting-queries.html" class="nav-link"><span class="nav-link-icon">ğŸ”</span> Hunting Queries</a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">4. EDR/XDR</div>
          <a href="edr-fundamentals.html" class="nav-link"><span class="nav-link-icon">ğŸ”’</span> EDR Fundamentals</a>
          <a href="edr-deep-dive.html" class="nav-link"><span class="nav-link-icon">ğŸ”¬</span> EDR Deep Dive</a>
          <a href="edr-investigation.html" class="nav-link"><span class="nav-link-icon">ğŸ•µï¸</span> EDR Investigation</a>
          <a href="edr-hunting.html" class="nav-link"><span class="nav-link-icon">ğŸ¯</span> EDR Hunting</a>
          <a href="isolation-procedures.html" class="nav-link"><span class="nav-link-icon">ğŸ”’</span> Isolation Procedures</a>
          <a href="xdr-overview.html" class="nav-link"><span class="nav-link-icon">ğŸŒ</span> XDR Overview</a>
          <a href="mde-overview.html" class="nav-link"><span class="nav-link-icon">ğŸ›¡ï¸</span> MDE Overview</a>
          <a href="mde-queries.html" class="nav-link"><span class="nav-link-icon">ğŸ’»</span> MDE Queries</a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">5. Network Security</div>
          <a href="network-fundamentals.html" class="nav-link"><span class="nav-link-icon">ğŸŒ</span> Network Fundamentals</a>
          <a href="firewall-basics.html" class="nav-link"><span class="nav-link-icon">ğŸ”¥</span> Firewall Basics</a>
          <a href="ids-ips.html" class="nav-link"><span class="nav-link-icon">ğŸš¨</span> IDS/IPS</a>
          <a href="proxy-analysis.html" class="nav-link"><span class="nav-link-icon">ğŸ”€</span> Proxy Analysis</a>
          <a href="dns-security.html" class="nav-link active"><span class="nav-link-icon">ğŸŒ</span> DNS Security</a>
          <a href="traffic-analysis.html" class="nav-link"><span class="nav-link-icon">ğŸ“Š</span> Traffic Analysis</a>
          <a href="network-forensics.html" class="nav-link"><span class="nav-link-icon">ğŸ”</span> Network Forensics</a>
          <a href="vpn-security.html" class="nav-link"><span class="nav-link-icon">ğŸ”</span> VPN Security</a>
          <a href="network-segmentation.html" class="nav-link"><span class="nav-link-icon">ğŸ”€</span> Segmentation</a>
          <a href="zero-trust.html" class="nav-link"><span class="nav-link-icon">ğŸ”</span> Zero Trust</a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">6. Cloud Security</div>
          <a href="cloud-overview.html" class="nav-link"><span class="nav-link-icon">â˜ï¸</span> Cloud Overview</a>
          <a href="aws-security.html" class="nav-link"><span class="nav-link-icon">ğŸ”¶</span> AWS Security</a>
          <a href="azure-security.html" class="nav-link"><span class="nav-link-icon">ğŸ”·</span> Azure Security</a>
          <a href="gcp-security.html" class="nav-link"><span class="nav-link-icon">ğŸ”´</span> GCP Security</a>
          <a href="m365-security.html" class="nav-link"><span class="nav-link-icon">ğŸ“§</span> M365 Security</a>
          <a href="cloud-iam.html" class="nav-link"><span class="nav-link-icon">ğŸ”‘</span> Cloud IAM</a>
          <a href="container-security.html" class="nav-link"><span class="nav-link-icon">ğŸ“¦</span> Container Security</a>
          <a href="serverless-security.html" class="nav-link"><span class="nav-link-icon">âš¡</span> Serverless Security</a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">7. Email & Phishing</div>
          <a href="email-security.html" class="nav-link"><span class="nav-link-icon">ğŸ“§</span> Email Security</a>
          <a href="phishing-analysis.html" class="nav-link"><span class="nav-link-icon">ğŸ£</span> Phishing Analysis</a>
          <a href="email-headers.html" class="nav-link"><span class="nav-link-icon">ğŸ“‹</span> Email Headers</a>
          <a href="email-auth.html" class="nav-link"><span class="nav-link-icon">ğŸ”</span> Email Authentication</a>
          <a href="bec-attacks.html" class="nav-link"><span class="nav-link-icon">ğŸ’¼</span> BEC Attacks</a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">8. Identity & Access</div>
          <a href="identity-overview.html" class="nav-link"><span class="nav-link-icon">ğŸ‘¤</span> Identity Overview</a>
          <a href="azure-ad-security.html" class="nav-link"><span class="nav-link-icon">ğŸ”·</span> Azure AD Security</a>
          <a href="ad-security.html" class="nav-link"><span class="nav-link-icon">ğŸ¢</span> AD Security</a>
          <a href="privileged-access.html" class="nav-link"><span class="nav-link-icon">ğŸ‘‘</span> Privileged Access</a>
          <a href="mfa-deep-dive.html" class="nav-link"><span class="nav-link-icon">ğŸ”</span> MFA Deep Dive</a>
          <a href="service-accounts.html" class="nav-link"><span class="nav-link-icon">âš™ï¸</span> Service Accounts</a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">9. Data Protection</div>
          <a href="data-classification.html" class="nav-link"><span class="nav-link-icon">ğŸ“Š</span> Data Classification</a>
          <a href="dlp-overview.html" class="nav-link"><span class="nav-link-icon">ğŸ›¡ï¸</span> DLP Overview</a>
          <a href="dlp-investigation.html" class="nav-link"><span class="nav-link-icon">ğŸ”</span> DLP Investigation</a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">10. Incident Response</div>
          <a href="ir-overview.html" class="nav-link"><span class="nav-link-icon">ğŸš¨</span> IR Overview</a>
          <a href="ir-classification.html" class="nav-link"><span class="nav-link-icon">ğŸ“‹</span> Classification</a>
          <a href="ir-containment.html" class="nav-link"><span class="nav-link-icon">ğŸ”’</span> Containment</a>
          <a href="ir-eradication.html" class="nav-link"><span class="nav-link-icon">ğŸ§¹</span> Eradication</a>
          <a href="ir-recovery.html" class="nav-link"><span class="nav-link-icon">ğŸ”„</span> Recovery</a>
          <a href="ir-communication.html" class="nav-link"><span class="nav-link-icon">ğŸ’¬</span> Communication</a>
          <a href="evidence-handling.html" class="nav-link"><span class="nav-link-icon">ğŸ“¦</span> Evidence Handling</a>
          <a href="lessons-learned.html" class="nav-link"><span class="nav-link-icon">ğŸ“</span> Lessons Learned</a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">11. Playbooks</div>
          <a href="pb-phishing.html" class="nav-link"><span class="nav-link-icon">ğŸ£</span> Phishing</a>
          <a href="pb-malware.html" class="nav-link"><span class="nav-link-icon">ğŸ¦ </span> Malware</a>
          <a href="pb-ransomware.html" class="nav-link"><span class="nav-link-icon">ğŸ’°</span> Ransomware</a>
          <a href="pb-account-compromise.html" class="nav-link"><span class="nav-link-icon">ğŸ‘¤</span> Account Compromise</a>
          <a href="pb-brute-force.html" class="nav-link"><span class="nav-link-icon">ğŸ”“</span> Brute Force</a>
          <a href="pb-impossible-travel.html" class="nav-link"><span class="nav-link-icon">âœˆï¸</span> Impossible Travel</a>
          <a href="pb-data-exfiltration.html" class="nav-link"><span class="nav-link-icon">ğŸ“¤</span> Data Exfiltration</a>
          <a href="pb-insider-threat.html" class="nav-link"><span class="nav-link-icon">ğŸ•µï¸</span> Insider Threat</a>
          <a href="pb-lateral-movement.html" class="nav-link"><span class="nav-link-icon">â†”ï¸</span> Lateral Movement</a>
          <a href="pb-c2.html" class="nav-link"><span class="nav-link-icon">ğŸ“¡</span> C2 Detection</a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">12. Reference</div>
          <a href="quick-reference.html" class="nav-link"><span class="nav-link-icon">âš¡</span> Quick Reference</a>
          <a href="common-ports.html" class="nav-link"><span class="nav-link-icon">ğŸ”Œ</span> Common Ports</a>
          <a href="windows-events.html" class="nav-link"><span class="nav-link-icon">ğŸªŸ</span> Windows Events</a>
          <a href="kql-cheatsheet.html" class="nav-link"><span class="nav-link-icon">ğŸ“‹</span> KQL Cheatsheet</a>
          <a href="regex-patterns.html" class="nav-link"><span class="nav-link-icon">ğŸ”£</span> Regex Patterns</a>
          <a href="mitre-reference.html" class="nav-link"><span class="nav-link-icon">ğŸ—ºï¸</span> MITRE Reference</a>
          <a href="ioc-tools.html" class="nav-link"><span class="nav-link-icon">ğŸ”§</span> IOC Tools</a>
          <a href="documentation.html" class="nav-link"><span class="nav-link-icon">ğŸ“</span> Documentation</a>
        </div>
      </div>
    </aside>

    <!-- Sidebar Toggle -->
    <button class="sidebar-toggle" aria-label="Toggle sidebar">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </button>

    <main class="main-content">
      <div class="content-header">
        <nav class="breadcrumb">
          <a href="index.html">Home</a>
          <span class="breadcrumb-separator">â€º</span>
          <a href="index.html#network">Network Security</a>
          <span class="breadcrumb-separator">â€º</span>
          <span>DNS Security</span>
        </nav>
        <h1>DNS Security</h1>
        <div class="page-meta">
          <span class="meta-item"><span class="tier-badge tier-all">All Tiers</span></span>
          <span class="meta-item">Section 5.5</span>
          <span class="meta-item">~12 min read</span>
        </div>
      </div>

      <div class="toc">
        <div class="toc-title">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 6h16M4 12h16M4 18h12"/>
          </svg>
          On This Page
        </div>
        <ul class="toc-list">
          <li><a href="#why">Why DNS Matters</a></li>
          <li><a href="#basics">DNS Basics</a></li>
          <li><a href="#attacks">DNS-Based Attacks</a></li>
          <li><a href="#detection">Detection Techniques</a></li>
          <li><a href="#investigation">Investigation Approach</a></li>
          <li><a href="#protection">DNS Protection</a></li>
        </ul>
      </div>

      <section id="why">
        <h2>Why DNS Matters for Security</h2>
        <p>
          DNS is one of the most valuable log sources for threat detection. Nearly all network 
          activityâ€”legitimate and maliciousâ€”requires DNS resolution.
        </p>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value">91%</div>
            <div class="stat-label">of malware uses DNS for C2</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">100%</div>
            <div class="stat-label">of network activity needs DNS</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">Often</div>
            <div class="stat-label">unmonitored in many orgs</div>
          </div>
        </div>

        <div class="callout callout-info">
          <div class="callout-title">DNS is Gold</div>
          <p style="margin: 0;">
            Attackers must resolve domain names to communicate with C2 servers. Even if they 
            encrypt traffic, the DNS query is often visible. DNS logs provide early warning 
            of compromise before payload delivery or data exfiltration.
          </p>
        </div>
      </section>

      <section id="basics">
        <h2>DNS Basics</h2>

        <h3>DNS Query Flow</h3>
        <div class="card">
          <div class="flowchart">
            <div class="flow-step">
              <div class="flow-node">
                <strong>Client</strong><br>
                <small>Needs IP for domain</small>
              </div>
              <div class="flow-arrow">â†’</div>
              <div class="flow-node">
                <strong>Local Resolver</strong><br>
                <small>Cache check</small>
              </div>
              <div class="flow-arrow">â†’</div>
              <div class="flow-node">
                <strong>Recursive DNS</strong><br>
                <small>Company/ISP DNS</small>
              </div>
              <div class="flow-arrow">â†’</div>
              <div class="flow-node">
                <strong>Authoritative DNS</strong><br>
                <small>Domain's nameserver</small>
              </div>
            </div>
          </div>
        </div>

        <h3>Common Record Types</h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Type</th>
                <th>Purpose</th>
                <th>Security Relevance</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>A</strong></td>
                <td>Domain â†’ IPv4 address</td>
                <td>Most common, C2 resolution</td>
              </tr>
              <tr>
                <td><strong>AAAA</strong></td>
                <td>Domain â†’ IPv6 address</td>
                <td>Same as A, for IPv6</td>
              </tr>
              <tr>
                <td><strong>CNAME</strong></td>
                <td>Alias to another domain</td>
                <td>CDN usage, domain fronting</td>
              </tr>
              <tr>
                <td><strong>MX</strong></td>
                <td>Mail server for domain</td>
                <td>Email infrastructure</td>
              </tr>
              <tr>
                <td><strong>TXT</strong></td>
                <td>Text records (SPF, DKIM)</td>
                <td>Data exfiltration, C2 commands</td>
              </tr>
              <tr>
                <td><strong>NS</strong></td>
                <td>Nameserver for domain</td>
                <td>DNS hijacking detection</td>
              </tr>
              <tr>
                <td><strong>PTR</strong></td>
                <td>IP â†’ Domain (reverse)</td>
                <td>Verification, attribution</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="attacks">
        <h2>DNS-Based Attacks</h2>

        <div class="accordion">
          <div class="accordion-item active">
            <div class="accordion-header">
              <span class="accordion-title">C2 Over DNS</span>
              <span class="accordion-icon">â–¼</span>
            </div>
            <div class="accordion-content">
              <p>Malware resolves attacker-controlled domains to receive commands or report status.</p>
              <h4>Indicators:</h4>
              <ul>
                <li>Queries to newly registered domains</li>
                <li>Queries to domains with low reputation</li>
                <li>Regular beacon pattern (e.g., every 60 seconds)</li>
                <li>Single host querying unique domain</li>
              </ul>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header">
              <span class="accordion-title">DNS Tunneling</span>
              <span class="accordion-icon">â–¼</span>
            </div>
            <div class="accordion-content">
              <p>Encoding data in DNS queries/responses to exfiltrate data or bypass firewalls.</p>
              <h4>Indicators:</h4>
              <ul>
                <li>Very long subdomain names (encoded data)</li>
                <li>High volume of TXT record queries</li>
                <li>Unusual query frequency to single domain</li>
                <li>High entropy in subdomain strings</li>
              </ul>
              <div class="terminal" style="margin-top: 1rem;">
                <div class="terminal-header">
                  <span class="terminal-dot red"></span>
                  <span class="terminal-dot yellow"></span>
                  <span class="terminal-dot green"></span>
                  <span style="margin-left: 1rem; color: var(--text-muted);">DNS Tunneling Example</span>
                </div>
                <div class="terminal-body">
<pre># Normal query:
www.example.com

# Tunneling query (data encoded in subdomain):
dGhpcyBpcyBzZWNyZXQgZGF0YQ.tunnel.evil.com</pre>
                </div>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header">
              <span class="accordion-title">Domain Generation Algorithms (DGA)</span>
              <span class="accordion-icon">â–¼</span>
            </div>
            <div class="accordion-content">
              <p>Malware generates pseudo-random domains to find active C2 servers.</p>
              <h4>Indicators:</h4>
              <ul>
                <li>Many NXDOMAIN responses (domain doesn't exist)</li>
                <li>Random-looking domain names</li>
                <li>High query volume in short time</li>
                <li>Pattern: consonant-heavy, no real words</li>
              </ul>
              <div class="terminal" style="margin-top: 1rem;">
                <div class="terminal-header">
                  <span class="terminal-dot red"></span>
                  <span class="terminal-dot yellow"></span>
                  <span class="terminal-dot green"></span>
                  <span style="margin-left: 1rem; color: var(--text-muted);">DGA Examples</span>
                </div>
                <div class="terminal-body">
<pre>xjkwqplmn.com
bvrtghzxc.net
qwfpgjluy.org
mnbvcxzas.com</pre>
                </div>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header">
              <span class="accordion-title">DNS Hijacking</span>
              <span class="accordion-icon">â–¼</span>
            </div>
            <div class="accordion-content">
              <p>Redirecting DNS queries to attacker-controlled servers.</p>
              <h4>Types:</h4>
              <ul>
                <li><strong>Local:</strong> Malware modifies host file or DNS settings</li>
                <li><strong>Router:</strong> Compromised router redirects DNS</li>
                <li><strong>Registrar:</strong> Domain registration hijacked</li>
                <li><strong>ISP-level:</strong> DNS responses modified in transit</li>
              </ul>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header">
              <span class="accordion-title">Fast Flux</span>
              <span class="accordion-icon">â–¼</span>
            </div>
            <div class="accordion-content">
              <p>Rapidly changing IP addresses for a domain to evade blocking.</p>
              <h4>Indicators:</h4>
              <ul>
                <li>Very low TTL values (seconds)</li>
                <li>Same domain resolves to many different IPs</li>
                <li>IPs from diverse geographic locations</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <section id="detection">
        <h2>Detection Techniques</h2>

        <div class="query-box">
          <div class="query-header">
            <span class="query-lang">KQL</span>
            <span class="query-title">Detect DNS tunneling (long subdomains)</span>
          </div>
          <div class="query-body">
<code>DnsEvents
| <span class="kw">where</span> TimeGenerated > <span class="fn">ago</span>(<span class="nu">24h</span>)
| <span class="kw">extend</span> SubdomainLength = <span class="fn">strlen</span>(<span class="fn">tostring</span>(<span class="fn">split</span>(Name, <span class="st">"."</span>)[<span class="nu">0</span>]))
| <span class="kw">where</span> SubdomainLength > <span class="nu">30</span>
| <span class="kw">summarize</span> QueryCount = <span class="fn">count</span>() <span class="kw">by</span> ClientIP, Name
| <span class="kw">where</span> QueryCount > <span class="nu">5</span>
| <span class="kw">order by</span> SubdomainLength <span class="kw">desc</span></code>
          </div>
        </div>

        <div class="query-box">
          <div class="query-header">
            <span class="query-lang">KQL</span>
            <span class="query-title">Detect DGA patterns (high NXDOMAIN rate)</span>
          </div>
          <div class="query-body">
<code>DnsEvents
| <span class="kw">where</span> TimeGenerated > <span class="fn">ago</span>(<span class="nu">24h</span>)
| <span class="kw">summarize</span> 
    TotalQueries = <span class="fn">count</span>(),
    NXDomainCount = <span class="fn">countif</span>(ResultCode == <span class="st">"NXDOMAIN"</span>)
    <span class="kw">by</span> ClientIP, bin(TimeGenerated, <span class="nu">1h</span>)
| <span class="kw">extend</span> NXDomainRatio = NXDomainCount * <span class="nu">100.0</span> / TotalQueries
| <span class="kw">where</span> NXDomainRatio > <span class="nu">50</span> <span class="kw">and</span> NXDomainCount > <span class="nu">100</span>
| <span class="kw">order by</span> NXDomainCount <span class="kw">desc</span></code>
          </div>
        </div>

        <div class="query-box">
          <div class="query-header">
            <span class="query-lang">KQL</span>
            <span class="query-title">Detect beaconing pattern</span>
          </div>
          <div class="query-body">
<code>DnsEvents
| <span class="kw">where</span> TimeGenerated > <span class="fn">ago</span>(<span class="nu">24h</span>)
| <span class="kw">summarize</span> QueryTimes = <span class="fn">make_list</span>(TimeGenerated) <span class="kw">by</span> ClientIP, Name
| <span class="kw">where</span> <span class="fn">array_length</span>(QueryTimes) > <span class="nu">20</span>
| <span class="kw">extend</span> Intervals = <span class="fn">series_diff</span>(QueryTimes)
<span class="cm">// Look for consistent intervals (beaconing)</span>
| <span class="kw">project</span> ClientIP, Name, QueryCount = <span class="fn">array_length</span>(QueryTimes)</code>
          </div>
        </div>

        <h3>Detection Indicators Summary</h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Indicator</th>
                <th>Suggests</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Long subdomain (>30 chars)</td>
                <td>DNS tunneling</td>
              </tr>
              <tr>
                <td>High NXDOMAIN rate (>50%)</td>
                <td>DGA activity</td>
              </tr>
              <tr>
                <td>High TXT query volume</td>
                <td>Tunneling or C2</td>
              </tr>
              <tr>
                <td>Regular query intervals</td>
                <td>Beaconing/C2</td>
              </tr>
              <tr>
                <td>Newly registered domain</td>
                <td>Malicious infrastructure</td>
              </tr>
              <tr>
                <td>Query only from one host</td>
                <td>Targeted C2</td>
              </tr>
              <tr>
                <td>Low TTL values</td>
                <td>Fast flux</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="investigation">
        <h2>Investigation Approach</h2>

        <ul class="checklist">
          <li><strong>Identify the querying host:</strong> Which internal IP made the query?</li>
          <li><strong>Check domain reputation:</strong> VirusTotal, URLhaus, threat intel feeds</li>
          <li><strong>Review query pattern:</strong> Frequency, timing, volume</li>
          <li><strong>Check domain age:</strong> Newly registered domains are suspicious</li>
          <li><strong>Examine subdomain:</strong> Is it random/encoded? Normal structure?</li>
          <li><strong>Correlate with endpoint:</strong> What process made the connection?</li>
          <li><strong>Check for resolution:</strong> Did query succeed? What IP returned?</li>
          <li><strong>Look for follow-on traffic:</strong> Did host connect to resolved IP?</li>
        </ul>

        <div class="callout callout-tip">
          <div class="callout-title">Pivot from DNS</div>
          <p style="margin: 0;">
            Use DNS queries as a starting point, then pivot to EDR to see what process made the 
            network connection. This connects network activity to process activity.
          </p>
        </div>
      </section>

      <section id="protection">
        <h2>DNS Protection Solutions</h2>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Solution</th>
                <th>What It Does</th>
                <th>Examples</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>DNS Filtering</strong></td>
                <td>Block malicious/unwanted domains</td>
                <td>Cisco Umbrella, Zscaler, Infoblox</td>
              </tr>
              <tr>
                <td><strong>DNS Sinkholing</strong></td>
                <td>Redirect malicious domains to safe IP</td>
                <td>Internal sinkhole, vendor service</td>
              </tr>
              <tr>
                <td><strong>DNSSEC</strong></td>
                <td>Cryptographic validation of responses</td>
                <td>Prevents response spoofing</td>
              </tr>
              <tr>
                <td><strong>DoH/DoT</strong></td>
                <td>Encrypted DNS queries</td>
                <td>Privacy, but reduces visibility</td>
              </tr>
              <tr>
                <td><strong>DNS Logging</strong></td>
                <td>Record all queries for analysis</td>
                <td>Windows DNS, BIND, Infoblox</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="callout callout-warning">
          <div class="callout-title">DoH/DoT Challenge</div>
          <p style="margin: 0;">
            DNS-over-HTTPS (DoH) encrypts DNS queries, improving privacy but reducing SOC visibility. 
            Consider blocking external DoH providers and using internal encrypted DNS to maintain visibility.
          </p>
        </div>
      </section>

      <div class="callout callout-success">
        <div class="callout-title">Key Takeaways</div>
        <ul style="margin: 0;">
          <li>DNS is critical for threat detectionâ€”most malware uses DNS</li>
          <li>Watch for: long subdomains, high NXDOMAIN, beaconing patterns</li>
          <li>DGA produces random-looking domains with high failure rates</li>
          <li>DNS tunneling encodes data in subdomain strings</li>
          <li>Always check domain reputation and registration date</li>
          <li>Pivot from DNS to endpoint data for full context</li>
        </ul>
      </div>

      <footer class="page-footer">
        <div class="footer-nav">
          <a href="proxy-analysis.html" class="footer-link">
            <span class="footer-link-label">â† Previous</span>
            <span class="footer-link-title">Proxy & Web Filtering</span>
          </a>
          <a href="traffic-analysis.html" class="footer-link" style="text-align: right;">
            <span class="footer-link-label">Next â†’</span>
            <span class="footer-link-title">Traffic Analysis</span>
          </a>
        </div>
      </footer>
    </main>
  </div>

  <script src="main.js"></script>
</body>
</html>
